<Ui xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.blizzard.com/wow/ui/">
	<Script file="Search.lua"></Script>

	<Button name="AltoSearchEntryTemplate" hidden="true" virtual="true">
		<Size x="615" y="41" />
		<Layers>
			<Layer level="BACKGROUND">
				<FontString parentKey="Name" inherits="GameFontNormal" justifyH="LEFT">
					<Size x="240" y="14" />
					<Anchors>
						<Anchor point="TOPLEFT" x="53" y="0" />
					</Anchors>
				</FontString>
				<FontString parentKey="Stat1" inherits="GameFontNormal" justifyH="CENTER">
					<Size x="160" y="32" />
					<Anchors>
						<Anchor point="TOPLEFT" relativeKey="$parent.Name" relativePoint="TOPRIGHT" x="5" y="0" />
					</Anchors>
				</FontString>
				<FontString parentKey="Stat2" inherits="GameFontNormal" justifyH="CENTER">
					<Size x="150" y="32" />
					<Anchors>
						<Anchor point="BOTTOMLEFT" relativeKey="$parent.Stat1" relativePoint="BOTTOMRIGHT" x="5" y="0" />
					</Anchors>
				</FontString>
				<FontString parentKey="Stat3" inherits="GameFontNormal" justifyH="CENTER">
					<Size x="50" y="32" />
					<Anchors>
						<Anchor point="BOTTOMLEFT" relativeKey="$parent.Stat2" relativePoint="BOTTOMRIGHT" x="0" y="0" />
					</Anchors>
				</FontString>
				<FontString parentKey="Stat4" inherits="GameFontNormal" justifyH="CENTER">
					<Size x="50" y="32" />
					<Anchors>
						<Anchor point="BOTTOMLEFT" relativeKey="$parent.Stat3" relativePoint="BOTTOMRIGHT" x="0" y="0" />
					</Anchors>
				</FontString>
				<FontString parentKey="Stat5" inherits="GameFontNormal" justifyH="CENTER">
					<Size x="50" y="32" />
					<Anchors>
						<Anchor point="BOTTOMLEFT" relativeKey="$parent.Stat4" relativePoint="BOTTOMRIGHT" x="0" y="0" />
					</Anchors>
				</FontString>
				<FontString parentKey="Stat6" inherits="GameFontNormal" justifyH="CENTER">
					<Size x="50" y="32" />
					<Anchors>
						<Anchor point="BOTTOMLEFT" relativeKey="$parent.Stat5" relativePoint="BOTTOMRIGHT" x="0" y="0" />
					</Anchors>
				</FontString>
				<FontString parentKey="ILvl" inherits="GameFontNormal" justifyH="CENTER">
					<Size x="50" y="32" />
					<Anchors>
						<Anchor point="BOTTOMLEFT" relativeKey="$parent.Stat6" relativePoint="BOTTOMRIGHT" x="0" y="0" />
					</Anchors>
				</FontString>
			</Layer>
		</Layers>
		<Frames>
			<Cooldown parentKey="Cooldown" inherits="CooldownFrameTemplate"/>
			<Button parentKey="Item" inherits="AltoItemButtonTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" x="10" y="0" />
				</Anchors>
				<Scripts>
					<OnLoad>
						local level = self:GetParent():GetFrameLevel()
						self:SetFrameLevel(level + 1)
					</OnLoad>
					<OnEnter>
						-- local link = select(2, GetItemInfo(self:GetID()))
						
						local link = self:GetParent():GetID()
						if link then link = Altoholic.Search:GetResult(link) end
						if link then link = link.link end
						if not link then link = select(2, GetItemInfo(self:GetID())) end
						
						if link then
							GameTooltip:SetOwner(self, "ANCHOR_RIGHT");
							GameTooltip:SetHyperlink(link);
							GameTooltip:Show();						
						end
					</OnEnter>
					<OnLeave>
						GameTooltip:Hide();
					</OnLeave>
					<OnClick>
						-- local link = select(2, GetItemInfo(self:GetID()))
							
						local link = self:GetParent():GetID()
						if link then link = Altoholic.Search:GetResult(link) end
						if link then link = link.link end
						if not link then link = select(2, GetItemInfo(self:GetID())) end
							
						if link then
							if ( button == "LeftButton" ) and ( IsControlKeyDown() ) then
								DressUpItemLink(link);
							elseif ( button == "LeftButton" ) and ( IsShiftKeyDown() ) then
								local chat = ChatEdit_GetLastActiveWindow()
								if chat:IsShown() then
									chat:Insert(link)
								else
									AltoholicFrame_SearchEditBox:SetText(GetItemInfo(link))
								end
							end
						end
					</OnClick>
				</Scripts>
			</Button>
			<Button parentKey="Source">
				<Size x="220" y="10" />
				<Anchors>
					<Anchor point="TOPLEFT" relativeKey="$parent.Name" relativePoint="BOTTOMLEFT" x="0" y="0" />
				</Anchors>
				<ButtonText parentKey="Text" justifyH="LEFT">
					<Size x="210" y="10" />
					<Anchors>
						<Anchor point="LEFT" x="0" y="0" />
					</Anchors>
				</ButtonText>
				<Scripts>
					<OnEnter>
						local id = self:GetID()
						if id == 0 then return end
						
						local link
						local result = Altoholic.Search:GetResult(id)
						
						if result.linetype == 3 then
							local _, _, spellID = DataStore:GetCraftLineInfo(result.profession, result.craftIndex)
							link = Altoholic:GetRecipeLink(spellID, result.professionName)
						elseif result.linetype == 4 then
							local LTL = LibStub("LibTradeLinks-1.0")
							link = Altoholic:GetRecipeLink(result.spellID, LTL:GetSkillName(result.skillID))
						end

						if link then
							GameTooltip:ClearLines();
							GameTooltip:SetOwner(self, "ANCHOR_RIGHT");
							GameTooltip:SetHyperlink(link);
							GameTooltip:AddLine(" ",1,1,1);
							GameTooltip:Show();
						end
					</OnEnter>
					<OnLeave>
						GameTooltip:Hide();
					</OnLeave>
					<OnClick>
						if ( button == "LeftButton" ) and ( IsShiftKeyDown() ) then
							local chat = ChatEdit_GetLastActiveWindow()
							if chat:IsShown() then
								local id = self:GetID()
								if id == 0 then return end
								
								local link
								local result = Altoholic.Search:GetResult(id)
								
								if result.linetype == 3 then
									local _, _, spellID = DataStore:GetCraftLineInfo(result.profession, result.craftIndex)
									link = Altoholic:GetRecipeLink(spellID, result.professionName)
								elseif result.linetype == 4 then
									local LTL = LibStub("LibTradeLinks-1.0")
									link = Altoholic:GetRecipeLink(result.spellID, LTL:GetSkillName(result.skillID))
								end
								
								if not link then return end
								chat:Insert(link)
							end
						end
					</OnClick>
				</Scripts>
				<NormalFont style="GameFontNormalSmallLeft"/>
			</Button>
		</Frames>
		<Scripts>
			<OnLoad>
				local level = self:GetParent():GetFrameLevel()
				self:SetFrameLevel(level + 1)
			</OnLoad>
		</Scripts>
		<HighlightTexture name="$parentHighlight" file="Interface\HelpFrame\HelpFrameButton-Highlight" alphaMode="ADD">
			<Size x="555" y="37" />
			<Anchors>
				<Anchor point="TOPLEFT" x="55" y="0" />
			</Anchors>
			<TexCoords left="0" right="1.0" top="0" bottom="0.578125"/>
		</HighlightTexture>
	</Button>

	<Frame name="AltoholicFrameSearch" parent="AltoholicTabSearch" hidden="true">
		<Size x="615" y="306" />
		<Anchors>
			<Anchor point="TOPRIGHT" x="39" y="-105" />
		</Anchors>
		<Frames>
			<ScrollFrame name="$parentScrollFrame" parentKey="ScrollFrame" inherits="FauxScrollFrameTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" />
					<Anchor point="BOTTOMRIGHT" />
				</Anchors>
				<Layers>
					<Layer level="ARTWORK">
						<Texture file="Interface\PaperDollInfoFrame\UI-Character-ScrollBar">
							<Size x="31" y="256" />
							<Anchors>
								<Anchor point="TOPLEFT" relativePoint="TOPRIGHT" x="-2" y="5" />
							</Anchors>
							<TexCoords left="0" right="0.484375" top="0" bottom="1.0"/>
						</Texture>
						<Texture file="Interface\PaperDollInfoFrame\UI-Character-ScrollBar">
							<Size x="31" y="106" />
							<Anchors>
								<Anchor point="BOTTOMLEFT" relativePoint="BOTTOMRIGHT" x="-2" y="0" />
							</Anchors>
							<TexCoords left="0.515625" right="1.0" top="0" bottom="0.4140625"/>
						</Texture>
					</Layer>
				</Layers>
				<Scripts>
					<OnVerticalScroll>
						FauxScrollFrame_OnVerticalScroll(self, offset, 41, Altoholic.Search.Update)
					</OnVerticalScroll>
				</Scripts>
			</ScrollFrame>
			
			<Button parentKey="Entry1" inherits="AltoSearchEntryTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" relativeTo="$parentScrollFrame" relativePoint="TOPLEFT" x="0" y="-5" />
				</Anchors>
			</Button>
			<Button parentKey="Entry2" inherits="AltoSearchEntryTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" relativeKey="$parent.Entry1" relativePoint="BOTTOMLEFT" />
				</Anchors>
			</Button>
			<Button parentKey="Entry3" inherits="AltoSearchEntryTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" relativeKey="$parent.Entry2" relativePoint="BOTTOMLEFT" />
				</Anchors>
			</Button>
			<Button parentKey="Entry4" inherits="AltoSearchEntryTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" relativeKey="$parent.Entry3" relativePoint="BOTTOMLEFT" />
				</Anchors>
			</Button>
			<Button parentKey="Entry5" inherits="AltoSearchEntryTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" relativeKey="$parent.Entry4" relativePoint="BOTTOMLEFT" />
				</Anchors>
			</Button>
			<Button parentKey="Entry6" inherits="AltoSearchEntryTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" relativeKey="$parent.Entry5" relativePoint="BOTTOMLEFT" />
				</Anchors>
			</Button>
			<Button parentKey="Entry7" inherits="AltoSearchEntryTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" relativeKey="$parent.Entry6" relativePoint="BOTTOMLEFT" />
				</Anchors>
			</Button>

		</Frames>
	</Frame>

</Ui>